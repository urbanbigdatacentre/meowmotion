
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://urbanbigdatacentre.github.io/meowmotion/reference/data_formatter/">
      
      
        <link rel="prev" href="../../examples/">
      
      
        <link rel="next" href="../meowmob/">
      
      
      <link rel="icon" href="../../assets/icon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.12">
    
    
      
        <title>Data Formatter - MeowMotion</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.2afb09e1.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="orange" data-md-color-accent="pink">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#meowmotion.data_formatter" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="MeowMotion" class="md-header__button md-logo" aria-label="MeowMotion" data-md-component="logo">
      
  <img src="../../assets/meowmotion_logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            MeowMotion
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Data Formatter
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="orange" data-md-color-accent="pink"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="deep-purple" data-md-color-accent="lime"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/urbanbigdatacentre/meowmotion" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    MeowMotion
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="MeowMotion" class="md-nav__button md-logo" aria-label="MeowMotion" data-md-component="logo">
      
  <img src="../../assets/meowmotion_logo.png" alt="logo">

    </a>
    MeowMotion
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/urbanbigdatacentre/meowmotion" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    MeowMotion
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Getting Started
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Getting Started
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/installation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Installation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/quick-start/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quick Start
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Usage Examples
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    API Reference
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            API Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Data Formatter
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Data Formatter
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#meowmotion.data_formatter" class="md-nav__link">
    <span class="md-ellipsis">
      data_formatter
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#meowmotion.data_formatter.calculateBearing" class="md-nav__link">
    <span class="md-ellipsis">
      calculateBearing
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#meowmotion.data_formatter.calculateStraightnessIndex" class="md-nav__link">
    <span class="md-ellipsis">
      calculateStraightnessIndex
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#meowmotion.data_formatter.checkIfAtGrrenSpace" class="md-nav__link">
    <span class="md-ellipsis">
      checkIfAtGrrenSpace
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#meowmotion.data_formatter.checkIfNearStop" class="md-nav__link">
    <span class="md-ellipsis">
      checkIfNearStop
    </span>
  </a>
  
    <nav class="md-nav" aria-label="checkIfNearStop">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#meowmotion.data_formatter.checkIfNearStop--example-dataframe-with-two-points" class="md-nav__link">
    <span class="md-ellipsis">
      Example DataFrame with two points
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#meowmotion.data_formatter.checkIfNearStop--example-geodataframe-representing-a-stop" class="md-nav__link">
    <span class="md-ellipsis">
      Example GeoDataFrame representing a stop
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#meowmotion.data_formatter.featureEngineering" class="md-nav__link">
    <span class="md-ellipsis">
      featureEngineering
    </span>
  </a>
  
    <nav class="md-nav" aria-label="featureEngineering">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#meowmotion.data_formatter.featureEngineering--suppose-trip_df-is-a-dataframe-of-trips-and-shapes-is-a-list-of-geodataframes" class="md-nav__link">
    <span class="md-ellipsis">
      Suppose 'trip_df' is a DataFrame of trips and 'shapes' is a list of GeoDataFrames
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#meowmotion.data_formatter.generateTrajStats" class="md-nav__link">
    <span class="md-ellipsis">
      generateTrajStats
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#meowmotion.data_formatter.processData" class="md-nav__link">
    <span class="md-ellipsis">
      processData
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#meowmotion.data_formatter.processTripData" class="md-nav__link">
    <span class="md-ellipsis">
      processTripData
    </span>
  </a>
  
    <nav class="md-nav" aria-label="processTripData">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#meowmotion.data_formatter.processTripData--suppose-you-already-have-three-dataframes-trip_point_df-na_flow_df-raw_df" class="md-nav__link">
    <span class="md-ellipsis">
      Suppose you already have three DataFrames: trip_point_df, na_flow_df, raw_df
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#meowmotion.data_formatter.readRawData" class="md-nav__link">
    <span class="md-ellipsis">
      readRawData
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#meowmotion.data_formatter.removeOutlier" class="md-nav__link">
    <span class="md-ellipsis">
      removeOutlier
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../meowmob/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Meowmob
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../model_tmd/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Model TMD
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../process_data/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Process Data
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../about/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    About
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#meowmotion.data_formatter" class="md-nav__link">
    <span class="md-ellipsis">
      data_formatter
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#meowmotion.data_formatter.calculateBearing" class="md-nav__link">
    <span class="md-ellipsis">
      calculateBearing
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#meowmotion.data_formatter.calculateStraightnessIndex" class="md-nav__link">
    <span class="md-ellipsis">
      calculateStraightnessIndex
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#meowmotion.data_formatter.checkIfAtGrrenSpace" class="md-nav__link">
    <span class="md-ellipsis">
      checkIfAtGrrenSpace
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#meowmotion.data_formatter.checkIfNearStop" class="md-nav__link">
    <span class="md-ellipsis">
      checkIfNearStop
    </span>
  </a>
  
    <nav class="md-nav" aria-label="checkIfNearStop">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#meowmotion.data_formatter.checkIfNearStop--example-dataframe-with-two-points" class="md-nav__link">
    <span class="md-ellipsis">
      Example DataFrame with two points
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#meowmotion.data_formatter.checkIfNearStop--example-geodataframe-representing-a-stop" class="md-nav__link">
    <span class="md-ellipsis">
      Example GeoDataFrame representing a stop
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#meowmotion.data_formatter.featureEngineering" class="md-nav__link">
    <span class="md-ellipsis">
      featureEngineering
    </span>
  </a>
  
    <nav class="md-nav" aria-label="featureEngineering">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#meowmotion.data_formatter.featureEngineering--suppose-trip_df-is-a-dataframe-of-trips-and-shapes-is-a-list-of-geodataframes" class="md-nav__link">
    <span class="md-ellipsis">
      Suppose 'trip_df' is a DataFrame of trips and 'shapes' is a list of GeoDataFrames
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#meowmotion.data_formatter.generateTrajStats" class="md-nav__link">
    <span class="md-ellipsis">
      generateTrajStats
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#meowmotion.data_formatter.processData" class="md-nav__link">
    <span class="md-ellipsis">
      processData
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#meowmotion.data_formatter.processTripData" class="md-nav__link">
    <span class="md-ellipsis">
      processTripData
    </span>
  </a>
  
    <nav class="md-nav" aria-label="processTripData">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#meowmotion.data_formatter.processTripData--suppose-you-already-have-three-dataframes-trip_point_df-na_flow_df-raw_df" class="md-nav__link">
    <span class="md-ellipsis">
      Suppose you already have three DataFrames: trip_point_df, na_flow_df, raw_df
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#meowmotion.data_formatter.readRawData" class="md-nav__link">
    <span class="md-ellipsis">
      readRawData
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#meowmotion.data_formatter.removeOutlier" class="md-nav__link">
    <span class="md-ellipsis">
      removeOutlier
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


  <h1>Data Formatter</h1>

<div class="doc doc-object doc-module">



<a id="meowmotion.data_formatter"></a>
    <div class="doc doc-contents first">









  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h2 id="meowmotion.data_formatter.calculateBearing" class="doc doc-heading">
            <code class=" language-python"><span class="n">calculateBearing</span><span class="p">(</span><span class="n">lat1</span><span class="p">,</span> <span class="n">lon1</span><span class="p">,</span> <span class="n">lat2</span><span class="p">,</span> <span class="n">lon2</span><span class="p">)</span></code>

<a href="#meowmotion.data_formatter.calculateBearing" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Computes the initial bearing (forward azimuth) from one geographic coordinate to another.
This bearing is measured clockwise from true north and returned as a value between 0 and 360 degrees.</p>


<details class="how-it-works" open>
  <summary>How It Works</summary>
  <ol>
<li>Converts both starting (lat1, lon1) and ending (lat2, lon2) coordinates to radians.</li>
<li>Uses the difference in longitudes (dlon) and trigonometric functions to calculate
   the bearing in radians.</li>
<li>Converts the bearing from radians to degrees.</li>
<li>Normalizes the result to ensure it falls within the range of [0, 360).</li>
</ol>
</details>

<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>lat1</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Latitude of the start location (in decimal degrees).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>lon1</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Longitude of the start location (in decimal degrees).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>lat2</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Latitude of the end location (in decimal degrees).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>lon2</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Longitude of the end location (in decimal degrees).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>float</code></td>            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The initial bearing in degrees, between 0 and 360.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>bearing = calculateBearing(12.9716, 77.5946, 13.0827, 80.2707)
print(bearing)
76.123456789  # Example output</p>
</blockquote>
</blockquote>
</blockquote>
</details>

            <details class="quote">
              <summary>Source code in <code>meowmotion/data_formatter.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">calculateBearing</span><span class="p">(</span><span class="n">lat1</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">lon1</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">lat2</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">lon2</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Computes the initial bearing (forward azimuth) from one geographic coordinate to another.</span>
<span class="sd">    This bearing is measured clockwise from true north and returned as a value between 0 and 360 degrees.</span>

<span class="sd">    How It Works:</span>
<span class="sd">        1. Converts both starting (lat1, lon1) and ending (lat2, lon2) coordinates to radians.</span>
<span class="sd">        2. Uses the difference in longitudes (dlon) and trigonometric functions to calculate</span>
<span class="sd">           the bearing in radians.</span>
<span class="sd">        3. Converts the bearing from radians to degrees.</span>
<span class="sd">        4. Normalizes the result to ensure it falls within the range of [0, 360).</span>

<span class="sd">    Args:</span>
<span class="sd">        lat1 (float): Latitude of the start location (in decimal degrees).</span>
<span class="sd">        lon1 (float): Longitude of the start location (in decimal degrees).</span>
<span class="sd">        lat2 (float): Latitude of the end location (in decimal degrees).</span>
<span class="sd">        lon2 (float): Longitude of the end location (in decimal degrees).</span>

<span class="sd">    Returns:</span>
<span class="sd">        float: The initial bearing in degrees, between 0 and 360.</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; bearing = calculateBearing(12.9716, 77.5946, 13.0827, 80.2707)</span>
<span class="sd">        &gt;&gt;&gt; print(bearing)</span>
<span class="sd">        76.123456789  # Example output</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">lon1</span><span class="p">,</span> <span class="n">lat1</span><span class="p">,</span> <span class="n">lon2</span><span class="p">,</span> <span class="n">lat2</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">,</span> <span class="p">[</span><span class="n">lon1</span><span class="p">,</span> <span class="n">lat1</span><span class="p">,</span> <span class="n">lon2</span><span class="p">,</span> <span class="n">lat2</span><span class="p">])</span>
    <span class="n">dlon</span> <span class="o">=</span> <span class="n">lon2</span> <span class="o">-</span> <span class="n">lon1</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">dlon</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">lat2</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">lat1</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">lat2</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">lat1</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">lat2</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">dlon</span><span class="p">)</span>
    <span class="n">bearing</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
    <span class="n">bearing</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">rad2deg</span><span class="p">(</span><span class="n">bearing</span><span class="p">)</span>
    <span class="n">bearing</span> <span class="o">=</span> <span class="p">(</span><span class="n">bearing</span> <span class="o">+</span> <span class="mi">360</span><span class="p">)</span> <span class="o">%</span> <span class="mi">360</span>
    <span class="k">return</span> <span class="n">bearing</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="meowmotion.data_formatter.calculateStraightnessIndex" class="doc doc-heading">
            <code class=" language-python"><span class="n">calculateStraightnessIndex</span><span class="p">(</span><span class="n">df</span><span class="p">)</span></code>

<a href="#meowmotion.data_formatter.calculateStraightnessIndex" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Calculates a trip’s "straightness index" by comparing the total distance traveled
to the straight-line distance between the first and last points. The resulting ratio
(straight-line distance ÷ actual path distance) measures how directly a traveler
moved from start to end.</p>


<details class="how-it-works" open>
  <summary>How It Works</summary>
  <ol>
<li>Summarizes the total distance covered (<code>distance_covered</code>).</li>
<li>Calculates the straight-line (haversine) distance between the first and last
   coordinates in the trip.</li>
<li>Divides the straight-line distance by the actual path length.</li>
<li>Returns that value for every row in the DataFrame.</li>
</ol>
</details>

<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>df</code>
            </td>
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A DataFrame representing a single trip, containing at least
- <code>lat</code>: Latitude coordinates
- <code>lng</code>: Longitude coordinates
- <code>distance_covered</code>: The distance between consecutive points (in meters)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[<span title="float">float</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List[float]: A list (the same length as <code>df</code>) with the same straightness index</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[<span title="float">float</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>repeated for each row. If the path length is 0 or NaN, returns <code>[np.nan] * len(df)</code>.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>import pandas as pd
from haversine import haversine
df = pd.DataFrame({
...     "lat": [12.9716, 13.0827],
...     "lng": [77.5946, 80.2707],
...     "distance_covered": [0, 35000]  # for example
... })
result = calculateStraightnessIndex(df)
print(result)
[0.5, 0.5]  # Indicates the path is half as direct as a straight line</p>
</blockquote>
</blockquote>
</blockquote>
</details>

            <details class="quote">
              <summary>Source code in <code>meowmotion/data_formatter.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">calculateStraightnessIndex</span><span class="p">(</span><span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates a trip’s &quot;straightness index&quot; by comparing the total distance traveled</span>
<span class="sd">    to the straight-line distance between the first and last points. The resulting ratio</span>
<span class="sd">    (straight-line distance ÷ actual path distance) measures how directly a traveler</span>
<span class="sd">    moved from start to end.</span>

<span class="sd">    How It Works:</span>
<span class="sd">        1. Summarizes the total distance covered (`distance_covered`).</span>
<span class="sd">        2. Calculates the straight-line (haversine) distance between the first and last</span>
<span class="sd">           coordinates in the trip.</span>
<span class="sd">        3. Divides the straight-line distance by the actual path length.</span>
<span class="sd">        4. Returns that value for every row in the DataFrame.</span>

<span class="sd">    Args:</span>
<span class="sd">        df (pd.DataFrame): A DataFrame representing a single trip, containing at least</span>
<span class="sd">            - `lat`: Latitude coordinates</span>
<span class="sd">            - `lng`: Longitude coordinates</span>
<span class="sd">            - `distance_covered`: The distance between consecutive points (in meters)</span>

<span class="sd">    Returns:</span>
<span class="sd">        List[float]: A list (the same length as `df`) with the same straightness index</span>
<span class="sd">        repeated for each row. If the path length is 0 or NaN, returns `[np.nan] * len(df)`.</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; import pandas as pd</span>
<span class="sd">        &gt;&gt;&gt; from haversine import haversine</span>
<span class="sd">        &gt;&gt;&gt; df = pd.DataFrame({</span>
<span class="sd">        ...     &quot;lat&quot;: [12.9716, 13.0827],</span>
<span class="sd">        ...     &quot;lng&quot;: [77.5946, 80.2707],</span>
<span class="sd">        ...     &quot;distance_covered&quot;: [0, 35000]  # for example</span>
<span class="sd">        ... })</span>
<span class="sd">        &gt;&gt;&gt; result = calculateStraightnessIndex(df)</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        [0.5, 0.5]  # Indicates the path is half as direct as a straight line</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Calculate the length of the actual path</span>
    <span class="n">path_length</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;distance_covered&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">path_length</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">path_length</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">]</span> <span class="o">*</span> <span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># Avoid division error</span>
    <span class="n">total_points</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="n">first_lat</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;lat&quot;</span><span class="p">]</span>
    <span class="n">first_lon</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;lng&quot;</span><span class="p">]</span>
    <span class="n">last_lat</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">total_points</span><span class="p">][</span><span class="s2">&quot;lat&quot;</span><span class="p">]</span>
    <span class="n">last_lon</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">total_points</span><span class="p">][</span><span class="s2">&quot;lng&quot;</span><span class="p">]</span>

    <span class="c1"># Calculate the length of the shortest possible straight line</span>
    <span class="n">straight_line_length</span> <span class="o">=</span> <span class="n">haversine</span><span class="p">(</span>
        <span class="p">(</span><span class="n">first_lat</span><span class="p">,</span> <span class="n">first_lon</span><span class="p">),</span> <span class="p">(</span><span class="n">last_lat</span><span class="p">,</span> <span class="n">last_lon</span><span class="p">),</span> <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;m&quot;</span>
    <span class="p">)</span>

    <span class="c1"># Calculate the straightness index</span>
    <span class="n">straightness_index</span> <span class="o">=</span> <span class="n">straight_line_length</span> <span class="o">/</span> <span class="n">path_length</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">straightness_index</span><span class="p">]</span> <span class="o">*</span> <span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="meowmotion.data_formatter.checkIfAtGrrenSpace" class="doc doc-heading">
            <code class=" language-python"><span class="n">checkIfAtGrrenSpace</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">sdf</span><span class="p">)</span></code>

<a href="#meowmotion.data_formatter.checkIfAtGrrenSpace" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Checks whether a trip has at least five data points that fall within the specified
green space polygons. If it does, the entire trip is marked with 1 for every row.
Otherwise, it returns 0 for each row.</p>


<details class="note" open>
  <summary>Note</summary>
  <ul>
<li>This function uses a threshold of five detections by default, but you can
  customize this threshold as needed.</li>
</ul>
</details>

<details class="how-it-works" open>
  <summary>How It Works</summary>
  <ol>
<li>Iterates through all points in <code>df</code> (each representing a trajectory point in the trip).</li>
<li>For each point, checks if it intersects any of the polygons in <code>sdf</code>.</li>
<li>If at least five points from the trip are found in a green space, returns a list
   of 1s (one per row in <code>df</code>).</li>
<li>Otherwise, returns a list of 0s.</li>
</ol>
</details>

<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>df</code>
            </td>
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>DataFrame containing trip data with at least <code>lat</code> and <code>lng</code>
columns for each point in the trip.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>sdf</code>
            </td>
            <td>
                  <code><span title="geopandas.GeoDataFrame">GeoDataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>GeoDataFrame representing one or more green space polygons.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[<span title="int">int</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List[int]: A list of integers (1 or 0) for each row in <code>df</code>.
- <code>[1, 1, ..., 1]</code> if at least five points are within green space
- <code>[0, 0, ..., 0]</code> otherwise</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>df = pd.DataFrame({
...     "lat": [12.9716, 12.9780, 12.9825, 12.9850, 12.9900],
...     "lng": [77.5946, 77.5949, 77.5953, 77.5960, 77.5965]
... })
green_spaces = gpd.read_file("greenspaces.shp")  # Example file
result = checkIfAtGrrenSpace(df, green_spaces)
print(result)
[1, 1, 1, 1, 1]   # indicates at least 5 points are inside a green space</p>
</blockquote>
</blockquote>
</blockquote>
</details>

            <details class="quote">
              <summary>Source code in <code>meowmotion/data_formatter.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">checkIfAtGrrenSpace</span><span class="p">(</span><span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">sdf</span><span class="p">:</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Checks whether a trip has at least five data points that fall within the specified</span>
<span class="sd">    green space polygons. If it does, the entire trip is marked with 1 for every row.</span>
<span class="sd">    Otherwise, it returns 0 for each row.</span>

<span class="sd">    Note:</span>
<span class="sd">        - This function uses a threshold of five detections by default, but you can</span>
<span class="sd">          customize this threshold as needed.</span>

<span class="sd">    How It Works:</span>
<span class="sd">        1. Iterates through all points in `df` (each representing a trajectory point in the trip).</span>
<span class="sd">        2. For each point, checks if it intersects any of the polygons in `sdf`.</span>
<span class="sd">        3. If at least five points from the trip are found in a green space, returns a list</span>
<span class="sd">           of 1s (one per row in `df`).</span>
<span class="sd">        4. Otherwise, returns a list of 0s.</span>

<span class="sd">    Args:</span>
<span class="sd">        df (pd.DataFrame): DataFrame containing trip data with at least `lat` and `lng`</span>
<span class="sd">            columns for each point in the trip.</span>
<span class="sd">        sdf (gpd.GeoDataFrame): GeoDataFrame representing one or more green space polygons.</span>

<span class="sd">    Returns:</span>
<span class="sd">        List[int]: A list of integers (1 or 0) for each row in `df`.</span>
<span class="sd">            - `[1, 1, ..., 1]` if at least five points are within green space</span>
<span class="sd">            - `[0, 0, ..., 0]` otherwise</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; df = pd.DataFrame({</span>
<span class="sd">        ...     &quot;lat&quot;: [12.9716, 12.9780, 12.9825, 12.9850, 12.9900],</span>
<span class="sd">        ...     &quot;lng&quot;: [77.5946, 77.5949, 77.5953, 77.5960, 77.5965]</span>
<span class="sd">        ... })</span>
<span class="sd">        &gt;&gt;&gt; green_spaces = gpd.read_file(&quot;greenspaces.shp&quot;)  # Example file</span>
<span class="sd">        &gt;&gt;&gt; result = checkIfAtGrrenSpace(df, green_spaces)</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        [1, 1, 1, 1, 1]   # indicates at least 5 points are inside a green space</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
        <span class="n">lat</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;lat&quot;</span><span class="p">]</span>
        <span class="n">lon</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;lng&quot;</span><span class="p">]</span>
        <span class="n">coord_point</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">)</span>
        <span class="n">point_found_at_gs</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">intersections</span> <span class="o">=</span> <span class="n">sdf</span><span class="o">.</span><span class="n">sindex</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">coord_point</span><span class="o">.</span><span class="n">bounds</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">intersections</span><span class="p">:</span>
            <span class="n">polygon</span> <span class="o">=</span> <span class="n">sdf</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s2">&quot;geometry&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">coord_point</span><span class="o">.</span><span class="n">intersects</span><span class="p">(</span><span class="n">polygon</span><span class="p">):</span>
                <span class="n">point_found_at_gs</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">break</span>
        <span class="k">if</span> <span class="n">point_found_at_gs</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">count</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
                <span class="k">break</span>
    <span class="k">if</span> <span class="n">count</span> <span class="o">&gt;=</span> <span class="mi">5</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="meowmotion.data_formatter.checkIfNearStop" class="doc doc-heading">
            <code class=" language-python"><span class="n">checkIfNearStop</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">sdf</span><span class="p">)</span></code>

<a href="#meowmotion.data_formatter.checkIfNearStop" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Determines whether the first and/or last point of a trip lies within a given
polygon area (e.g., bus stop, train station, or metro station). It returns a list
of length equal to <code>df.shape[0]</code>, with each element indicating whether:</p>
<ul>
<li>Both the first and last points intersect the polygon(s): 2</li>
<li>Only one of the points intersects the polygon(s): 1</li>
<li>Neither the first nor the last point intersects the polygon(s): 0</li>
</ul>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>df</code>
            </td>
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>DataFrame containing trip data, including <code>lat</code> and <code>lng</code>
columns for each point in the trip.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>sdf</code>
            </td>
            <td>
                  <code><span title="geopandas.GeoDataFrame">GeoDataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>GeoDataFrame representing polygons for stops or stations
(e.g., bus stops, train stations, metro stations).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[<span title="int">int</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List[int]: A list of integers (2, 1, or 0) indicating the presence of the</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[<span title="int">int</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>first/last point in the polygon(s).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>import pandas as pd
import geopandas as gpd
from shapely.geometry import Polygon</p>
<h3 id="meowmotion.data_formatter.checkIfNearStop--example-dataframe-with-two-points">Example DataFrame with two points<a class="headerlink" href="#meowmotion.data_formatter.checkIfNearStop--example-dataframe-with-two-points" title="Permanent link">&para;</a></h3>
<p>df = pd.DataFrame({
...     'lat': [12.9716, 12.9760],
...     'lng': [77.5946, 77.5950]
... })</p>
<h3 id="meowmotion.data_formatter.checkIfNearStop--example-geodataframe-representing-a-stop">Example GeoDataFrame representing a stop<a class="headerlink" href="#meowmotion.data_formatter.checkIfNearStop--example-geodataframe-representing-a-stop" title="Permanent link">&para;</a></h3>
<p>polygons = [Polygon([(77.5940, 12.9710), (77.5950, 12.9710),
...                      (77.5950, 12.9720), (77.5940, 12.9720)])]
sdf = gpd.GeoDataFrame(geometry=polygons, crs="EPSG:4326")
result = checkIfNearStop(df, sdf)
print(result)
[1, 1]  # Only the first point intersects the polygon</p>
</blockquote>
</blockquote>
</blockquote>
</details>

            <details class="quote">
              <summary>Source code in <code>meowmotion/data_formatter.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">checkIfNearStop</span><span class="p">(</span><span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">sdf</span><span class="p">:</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Determines whether the first and/or last point of a trip lies within a given</span>
<span class="sd">    polygon area (e.g., bus stop, train station, or metro station). It returns a list</span>
<span class="sd">    of length equal to `df.shape[0]`, with each element indicating whether:</span>

<span class="sd">    - Both the first and last points intersect the polygon(s): 2</span>
<span class="sd">    - Only one of the points intersects the polygon(s): 1</span>
<span class="sd">    - Neither the first nor the last point intersects the polygon(s): 0</span>

<span class="sd">    Args:</span>
<span class="sd">        df (pd.DataFrame): DataFrame containing trip data, including `lat` and `lng`</span>
<span class="sd">            columns for each point in the trip.</span>
<span class="sd">        sdf (gpd.GeoDataFrame): GeoDataFrame representing polygons for stops or stations</span>
<span class="sd">            (e.g., bus stops, train stations, metro stations).</span>

<span class="sd">    Returns:</span>
<span class="sd">        List[int]: A list of integers (2, 1, or 0) indicating the presence of the</span>
<span class="sd">        first/last point in the polygon(s).</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; import pandas as pd</span>
<span class="sd">        &gt;&gt;&gt; import geopandas as gpd</span>
<span class="sd">        &gt;&gt;&gt; from shapely.geometry import Polygon</span>
<span class="sd">        &gt;&gt;&gt; # Example DataFrame with two points</span>
<span class="sd">        &gt;&gt;&gt; df = pd.DataFrame({</span>
<span class="sd">        ...     &#39;lat&#39;: [12.9716, 12.9760],</span>
<span class="sd">        ...     &#39;lng&#39;: [77.5946, 77.5950]</span>
<span class="sd">        ... })</span>
<span class="sd">        &gt;&gt;&gt; # Example GeoDataFrame representing a stop</span>
<span class="sd">        &gt;&gt;&gt; polygons = [Polygon([(77.5940, 12.9710), (77.5950, 12.9710),</span>
<span class="sd">        ...                      (77.5950, 12.9720), (77.5940, 12.9720)])]</span>
<span class="sd">        &gt;&gt;&gt; sdf = gpd.GeoDataFrame(geometry=polygons, crs=&quot;EPSG:4326&quot;)</span>
<span class="sd">        &gt;&gt;&gt; result = checkIfNearStop(df, sdf)</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        [1, 1]  # Only the first point intersects the polygon</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">total_points</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="n">first_lat</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;lat&quot;</span><span class="p">]</span>
    <span class="n">first_lon</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;lng&quot;</span><span class="p">]</span>
    <span class="n">last_lat</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">total_points</span><span class="p">][</span><span class="s2">&quot;lat&quot;</span><span class="p">]</span>
    <span class="n">last_lon</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">total_points</span><span class="p">][</span><span class="s2">&quot;lng&quot;</span><span class="p">]</span>
    <span class="n">first_point</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="n">first_lon</span><span class="p">,</span> <span class="n">first_lat</span><span class="p">)</span>
    <span class="n">last_point</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="n">last_lon</span><span class="p">,</span> <span class="n">last_lat</span><span class="p">)</span>
    <span class="n">first_point_found</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">last_point_found</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="c1"># checking for first point</span>
    <span class="n">intersections</span> <span class="o">=</span> <span class="n">sdf</span><span class="o">.</span><span class="n">sindex</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">first_point</span><span class="o">.</span><span class="n">bounds</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">intersections</span><span class="p">:</span>
        <span class="n">polygon</span> <span class="o">=</span> <span class="n">sdf</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s2">&quot;geometry&quot;</span><span class="p">]</span>
        <span class="c1"># Check for intersection</span>
        <span class="k">if</span> <span class="n">first_point</span><span class="o">.</span><span class="n">intersects</span><span class="p">(</span><span class="n">polygon</span><span class="p">):</span>
            <span class="n">first_point_found</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">break</span>

    <span class="c1"># checking for last point</span>
    <span class="n">intersections</span> <span class="o">=</span> <span class="n">sdf</span><span class="o">.</span><span class="n">sindex</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">last_point</span><span class="o">.</span><span class="n">bounds</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">intersections</span><span class="p">:</span>
        <span class="n">polygon</span> <span class="o">=</span> <span class="n">sdf</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s2">&quot;geometry&quot;</span><span class="p">]</span>
        <span class="c1"># Check for intersection</span>
        <span class="k">if</span> <span class="n">last_point</span><span class="o">.</span><span class="n">intersects</span><span class="p">(</span><span class="n">polygon</span><span class="p">):</span>
            <span class="n">last_point_found</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">break</span>

    <span class="k">if</span> <span class="n">first_point_found</span> <span class="ow">and</span> <span class="n">last_point_found</span><span class="p">:</span>
        <span class="n">ar</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">ar</span>
    <span class="k">elif</span> <span class="n">first_point_found</span> <span class="ow">or</span> <span class="n">last_point_found</span><span class="p">:</span>
        <span class="n">ar</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">ar</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ar</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">ar</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="meowmotion.data_formatter.featureEngineering" class="doc doc-heading">
            <code class=" language-python"><span class="n">featureEngineering</span><span class="p">(</span><span class="n">trip_df</span><span class="p">,</span> <span class="n">shape_files</span><span class="p">,</span> <span class="n">cpu_cores</span><span class="o">=</span><span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">cpu_count</span><span class="p">()</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)))</span></code>

<a href="#meowmotion.data_formatter.featureEngineering" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Performs feature engineering on raw trip data by partitioning it and processing each partition
in parallel. This includes calculating advanced trip features such as speed, acceleration,
angular deviation, and straightness index, as well as identifying whether a trip starts or ends
near transport stops or green spaces.</p>
<p>This function distributes work across the specified number of CPU cores, calls the <code>processData</code>
child function on each chunk, and then merges all processed chunks into a single DataFrame.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>trip_df</code>
            </td>
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A DataFrame containing raw trip information, including columns for
user ID, trip ID, latitude (<code>lat</code>), longitude (<code>lng</code>), and timestamps (<code>datetime</code>).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>shape_files</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span>[<span title="geopandas.GeoDataFrame">GeoDataFrame</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of GeoDataFrames representing various geographic
layers (e.g., bus stops, train stops, metro stops, green spaces). These are used to check
if trips start/end near these points or areas.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>cpu_cores</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of CPU cores to use for parallel processing. Defaults to half
of the available cores.</p>
              </div>
            </td>
            <td>
                  <code><span title="max">max</span>(1, <span title="int">int</span>(<span title="multiprocessing.cpu_count">cpu_count</span>() // 2))</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>pd.DataFrame: A concatenated DataFrame containing the enhanced feature set for all trips.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Features include:
- Speed, acceleration, jerk, and angular deviation
- Straightness index
- Indicators for whether a trip begins or ends near transport stops or in green spaces
- Filtered trips based on minimum impressions</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<h3 id="meowmotion.data_formatter.featureEngineering--suppose-trip_df-is-a-dataframe-of-trips-and-shapes-is-a-list-of-geodataframes">Suppose 'trip_df' is a DataFrame of trips and 'shapes' is a list of GeoDataFrames<a class="headerlink" href="#meowmotion.data_formatter.featureEngineering--suppose-trip_df-is-a-dataframe-of-trips-and-shapes-is-a-list-of-geodataframes" title="Permanent link">&para;</a></h3>
<p>from your_module import featureEngineering
enhanced_df = featureEngineering(trip_df, shapes, cores=4)
print(enhanced_df.head())</p>
</blockquote>
</blockquote>
</blockquote>
</details>

            <details class="quote">
              <summary>Source code in <code>meowmotion/data_formatter.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">featureEngineering</span><span class="p">(</span>
    <span class="n">trip_df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="n">shape_files</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">],</span>
    <span class="n">cpu_cores</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">cpu_count</span><span class="p">()</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)),</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Performs feature engineering on raw trip data by partitioning it and processing each partition</span>
<span class="sd">    in parallel. This includes calculating advanced trip features such as speed, acceleration,</span>
<span class="sd">    angular deviation, and straightness index, as well as identifying whether a trip starts or ends</span>
<span class="sd">    near transport stops or green spaces.</span>

<span class="sd">    This function distributes work across the specified number of CPU cores, calls the `processData`</span>
<span class="sd">    child function on each chunk, and then merges all processed chunks into a single DataFrame.</span>

<span class="sd">    Args:</span>
<span class="sd">        trip_df (pd.DataFrame): A DataFrame containing raw trip information, including columns for</span>
<span class="sd">            user ID, trip ID, latitude (`lat`), longitude (`lng`), and timestamps (`datetime`).</span>
<span class="sd">        shape_files (List[gpd.GeoDataFrame]): A list of GeoDataFrames representing various geographic</span>
<span class="sd">            layers (e.g., bus stops, train stops, metro stops, green spaces). These are used to check</span>
<span class="sd">            if trips start/end near these points or areas.</span>
<span class="sd">        cpu_cores (int, optional): Number of CPU cores to use for parallel processing. Defaults to half</span>
<span class="sd">            of the available cores.</span>

<span class="sd">    Returns:</span>
<span class="sd">        pd.DataFrame: A concatenated DataFrame containing the enhanced feature set for all trips.</span>
<span class="sd">        Features include:</span>
<span class="sd">            - Speed, acceleration, jerk, and angular deviation</span>
<span class="sd">            - Straightness index</span>
<span class="sd">            - Indicators for whether a trip begins or ends near transport stops or in green spaces</span>
<span class="sd">            - Filtered trips based on minimum impressions</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # Suppose &#39;trip_df&#39; is a DataFrame of trips and &#39;shapes&#39; is a list of GeoDataFrames</span>
<span class="sd">        &gt;&gt;&gt; from your_module import featureEngineering</span>
<span class="sd">        &gt;&gt;&gt; enhanced_df = featureEngineering(trip_df, shapes, cores=4)</span>
<span class="sd">        &gt;&gt;&gt; print(enhanced_df.head())</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="si">}</span><span class="s2">: Get Load Balanced Buckets&quot;</span><span class="p">)</span>
    <span class="n">df_collection</span> <span class="o">=</span> <span class="n">getLoadBalancedBuckets</span><span class="p">(</span><span class="n">trip_df</span><span class="p">,</span> <span class="n">cpu_cores</span><span class="p">)</span>
    <span class="n">args</span> <span class="o">=</span> <span class="p">[(</span><span class="n">df</span><span class="p">,</span> <span class="n">shape_files</span><span class="p">)</span> <span class="k">for</span> <span class="n">df</span> <span class="ow">in</span> <span class="n">df_collection</span><span class="p">]</span>  <span class="c1"># Wrap each df in a tuple</span>
    <span class="k">del</span> <span class="n">df_collection</span>
    <span class="k">with</span> <span class="n">Pool</span><span class="p">(</span><span class="n">cpu_cores</span><span class="p">)</span> <span class="k">as</span> <span class="n">p</span><span class="p">:</span>
        <span class="n">tdf</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">starmap</span><span class="p">(</span><span class="n">processData</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">tdf</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="meowmotion.data_formatter.generateTrajStats" class="doc doc-heading">
            <code class=" language-python"><span class="n">generateTrajStats</span><span class="p">(</span><span class="n">df</span><span class="p">)</span></code>

<a href="#meowmotion.data_formatter.generateTrajStats" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Aggregates and summarizes key trip-level statistics (e.g., median/percentile speeds,
accelerations, jerk, angular deviation, distance) from enhanced trip data. This function
operates on data that has already undergone feature engineering (e.g., via <code>featureEngineering</code>),
and creates consolidated columns reflecting various trip metrics. A progress bar is displayed
during calculation.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>df</code>
            </td>
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A DataFrame containing enhanced trip data, including columns such as
<code>uid</code>, <code>trip_id</code>, <code>new_speed</code>, <code>accelaration</code>, <code>jerk</code>, and <code>angular_deviation</code>.
It may also contain flags for stops and green spaces.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>pd.DataFrame: A DataFrame containing aggregated statistics for each trip, including:
- Speed median, 95th percentile, and standard deviation
- Acceleration median, 95th percentile, and standard deviation
- Jerk median, 95th percentile, and standard deviation
- Angular deviation median, 95th percentile, and standard deviation
- Straightness index
- Total distance covered (km)
- Indicators for whether the trip starts/ends near specific transport stops or green spaces
- Weekend/hour categories
- A placeholder for <code>transport_mode</code></p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>import pandas as pd
data = {
...     "uid": [1, 1, 1, 2, 2],
...     "trip_id": [10, 10, 10, 20, 20],
...     "new_speed": [3.0, 5.5, 2.0, 4.0, 4.5],
...     "accelaration": [0.1, 0.2, 0.3, 0.1, 0.05],
...     "jerk": [0.01, 0.02, 0.03, 0.01, 0.02],
...     "angular_deviation": [5, 10, 15, 3, 4],
... }
df = pd.DataFrame(data)
result = generateTrajStats(df)
result.head()
   datetime  uid  trip_id  speed_median  ...  hour_category  transport_mode
0       NaT    1       10           3.5  ...             0             NaN
1       NaT    1       10           3.5  ...             0             NaN
2       NaT    1       10           3.5  ...             0             NaN
3       NaT    2       20           4.25 ...             0             NaN
4       NaT    2       20           4.25 ...             0             NaN</p>
</blockquote>
</blockquote>
</blockquote>
</details>

            <details class="quote">
              <summary>Source code in <code>meowmotion/data_formatter.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">generateTrajStats</span><span class="p">(</span><span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Aggregates and summarizes key trip-level statistics (e.g., median/percentile speeds,</span>
<span class="sd">    accelerations, jerk, angular deviation, distance) from enhanced trip data. This function</span>
<span class="sd">    operates on data that has already undergone feature engineering (e.g., via `featureEngineering`),</span>
<span class="sd">    and creates consolidated columns reflecting various trip metrics. A progress bar is displayed</span>
<span class="sd">    during calculation.</span>

<span class="sd">    Args:</span>
<span class="sd">        df (pd.DataFrame): A DataFrame containing enhanced trip data, including columns such as</span>
<span class="sd">            `uid`, `trip_id`, `new_speed`, `accelaration`, `jerk`, and `angular_deviation`.</span>
<span class="sd">            It may also contain flags for stops and green spaces.</span>

<span class="sd">    Returns:</span>
<span class="sd">        pd.DataFrame: A DataFrame containing aggregated statistics for each trip, including:</span>
<span class="sd">            - Speed median, 95th percentile, and standard deviation</span>
<span class="sd">            - Acceleration median, 95th percentile, and standard deviation</span>
<span class="sd">            - Jerk median, 95th percentile, and standard deviation</span>
<span class="sd">            - Angular deviation median, 95th percentile, and standard deviation</span>
<span class="sd">            - Straightness index</span>
<span class="sd">            - Total distance covered (km)</span>
<span class="sd">            - Indicators for whether the trip starts/ends near specific transport stops or green spaces</span>
<span class="sd">            - Weekend/hour categories</span>
<span class="sd">            - A placeholder for `transport_mode`</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; import pandas as pd</span>
<span class="sd">        &gt;&gt;&gt; data = {</span>
<span class="sd">        ...     &quot;uid&quot;: [1, 1, 1, 2, 2],</span>
<span class="sd">        ...     &quot;trip_id&quot;: [10, 10, 10, 20, 20],</span>
<span class="sd">        ...     &quot;new_speed&quot;: [3.0, 5.5, 2.0, 4.0, 4.5],</span>
<span class="sd">        ...     &quot;accelaration&quot;: [0.1, 0.2, 0.3, 0.1, 0.05],</span>
<span class="sd">        ...     &quot;jerk&quot;: [0.01, 0.02, 0.03, 0.01, 0.02],</span>
<span class="sd">        ...     &quot;angular_deviation&quot;: [5, 10, 15, 3, 4],</span>
<span class="sd">        ... }</span>
<span class="sd">        &gt;&gt;&gt; df = pd.DataFrame(data)</span>
<span class="sd">        &gt;&gt;&gt; result = generateTrajStats(df)</span>
<span class="sd">        &gt;&gt;&gt; result.head()</span>
<span class="sd">           datetime  uid  trip_id  speed_median  ...  hour_category  transport_mode</span>
<span class="sd">        0       NaT    1       10           3.5  ...             0             NaN</span>
<span class="sd">        1       NaT    1       10           3.5  ...             0             NaN</span>
<span class="sd">        2       NaT    1       10           3.5  ...             0             NaN</span>
<span class="sd">        3       NaT    2       20           4.25 ...             0             NaN</span>
<span class="sd">        4       NaT    2       20           4.25 ...             0             NaN</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">progress_bar</span> <span class="o">=</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">total</span><span class="o">=</span><span class="mi">25</span><span class="p">)</span>

    <span class="n">temp_df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="k">if</span> <span class="s2">&quot;transport_mode&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">temp_df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="n">temp_df</span><span class="p">[</span><span class="s2">&quot;transport_mode&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

    <span class="n">progress_bar</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">temp_df</span><span class="p">[</span><span class="s2">&quot;speed_median&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">temp_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;uid&quot;</span><span class="p">,</span> <span class="s2">&quot;trip_id&quot;</span><span class="p">])[</span>
        <span class="s2">&quot;new_speed&quot;</span>
    <span class="p">]</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">median</span><span class="p">())</span>
    <span class="n">progress_bar</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">temp_df</span><span class="p">[</span><span class="s2">&quot;speed_pct_95&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">temp_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;uid&quot;</span><span class="p">,</span> <span class="s2">&quot;trip_id&quot;</span><span class="p">])[</span>
        <span class="s2">&quot;new_speed&quot;</span>
    <span class="p">]</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">95</span><span class="p">))</span>
    <span class="n">progress_bar</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">temp_df</span><span class="p">[</span><span class="s2">&quot;speed_std&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">temp_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;uid&quot;</span><span class="p">,</span> <span class="s2">&quot;trip_id&quot;</span><span class="p">])[</span><span class="s2">&quot;new_speed&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span>
        <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">progress_bar</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">temp_df</span><span class="p">[</span><span class="s2">&quot;acceleration_median&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">temp_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;uid&quot;</span><span class="p">,</span> <span class="s2">&quot;trip_id&quot;</span><span class="p">])[</span>
        <span class="s2">&quot;accelaration&quot;</span>
    <span class="p">]</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmedian</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
    <span class="n">progress_bar</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">temp_df</span><span class="p">[</span><span class="s2">&quot;acceleration_pct_95&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">temp_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;uid&quot;</span><span class="p">,</span> <span class="s2">&quot;trip_id&quot;</span><span class="p">])[</span>
        <span class="s2">&quot;accelaration&quot;</span>
    <span class="p">]</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">nanpercentile</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">95</span><span class="p">))</span>
    <span class="n">progress_bar</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">temp_df</span><span class="p">[</span><span class="s2">&quot;acceleration_std&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">temp_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;uid&quot;</span><span class="p">,</span> <span class="s2">&quot;trip_id&quot;</span><span class="p">])[</span>
        <span class="s2">&quot;accelaration&quot;</span>
    <span class="p">]</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">nanstd</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
    <span class="n">progress_bar</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">temp_df</span><span class="p">[</span><span class="s2">&quot;jerk_median&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">temp_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;uid&quot;</span><span class="p">,</span> <span class="s2">&quot;trip_id&quot;</span><span class="p">])[</span><span class="s2">&quot;jerk&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span>
        <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmedian</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">progress_bar</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">temp_df</span><span class="p">[</span><span class="s2">&quot;jerk_pct_95&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">temp_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;uid&quot;</span><span class="p">,</span> <span class="s2">&quot;trip_id&quot;</span><span class="p">])[</span><span class="s2">&quot;jerk&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span>
        <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">nanpercentile</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">95</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">progress_bar</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">temp_df</span><span class="p">[</span><span class="s2">&quot;jerk_std&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">temp_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;uid&quot;</span><span class="p">,</span> <span class="s2">&quot;trip_id&quot;</span><span class="p">])[</span><span class="s2">&quot;jerk&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span>
        <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">nanstd</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">progress_bar</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">temp_df</span><span class="p">[</span><span class="s2">&quot;angular_dev_median&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">temp_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;uid&quot;</span><span class="p">,</span> <span class="s2">&quot;trip_id&quot;</span><span class="p">])[</span>
        <span class="s2">&quot;angular_deviation&quot;</span>
    <span class="p">]</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmedian</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
    <span class="n">progress_bar</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">temp_df</span><span class="p">[</span><span class="s2">&quot;angular_dev_pct_95&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">temp_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;uid&quot;</span><span class="p">,</span> <span class="s2">&quot;trip_id&quot;</span><span class="p">])[</span>
        <span class="s2">&quot;angular_deviation&quot;</span>
    <span class="p">]</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">nanpercentile</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">95</span><span class="p">))</span>
    <span class="n">progress_bar</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">temp_df</span><span class="p">[</span><span class="s2">&quot;angular_dev_std&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">temp_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;uid&quot;</span><span class="p">,</span> <span class="s2">&quot;trip_id&quot;</span><span class="p">])[</span>
        <span class="s2">&quot;angular_deviation&quot;</span>
    <span class="p">]</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">nanstd</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
    <span class="n">progress_bar</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">temp_df</span><span class="p">[</span><span class="s2">&quot;straightness_index&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">temp_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;uid&quot;</span><span class="p">,</span> <span class="s2">&quot;trip_id&quot;</span><span class="p">])[</span>
        <span class="s2">&quot;straightness_index&quot;</span>
    <span class="p">]</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">progress_bar</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">temp_df</span><span class="p">[</span><span class="s2">&quot;distance_covered&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">temp_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;uid&quot;</span><span class="p">,</span> <span class="s2">&quot;trip_id&quot;</span><span class="p">])[</span>
        <span class="s2">&quot;distance_covered&quot;</span>
    <span class="p">]</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">sum</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">)</span>
    <span class="n">progress_bar</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">temp_df</span><span class="p">[</span><span class="s2">&quot;start_end_at_bus_stop&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">temp_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;uid&quot;</span><span class="p">,</span> <span class="s2">&quot;trip_id&quot;</span><span class="p">])[</span>
        <span class="s2">&quot;start_end_at_bus_stop&quot;</span>
    <span class="p">]</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">progress_bar</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">temp_df</span><span class="p">[</span><span class="s2">&quot;start_end_at_train_stop&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">temp_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;uid&quot;</span><span class="p">,</span> <span class="s2">&quot;trip_id&quot;</span><span class="p">])[</span>
        <span class="s2">&quot;start_end_at_train_stop&quot;</span>
    <span class="p">]</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">progress_bar</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">temp_df</span><span class="p">[</span><span class="s2">&quot;start_end_at_metro_stop&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">temp_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;uid&quot;</span><span class="p">,</span> <span class="s2">&quot;trip_id&quot;</span><span class="p">])[</span>
        <span class="s2">&quot;start_end_at_metro_stop&quot;</span>
    <span class="p">]</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">progress_bar</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">temp_df</span><span class="p">[</span><span class="s2">&quot;found_at_green_space&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">temp_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;uid&quot;</span><span class="p">,</span> <span class="s2">&quot;trip_id&quot;</span><span class="p">])[</span>
        <span class="s2">&quot;found_at_green_space&quot;</span>
    <span class="p">]</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">progress_bar</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="c1"># temp_df[&#39;temperature&#39;]=temp_df.groupby([&#39;uid&#39;,&#39;trip_id&#39;])[&#39;t&#39;].transform(lambda x: x.mean())</span>
    <span class="n">progress_bar</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="c1"># temp_df[&#39;visibility&#39;]=temp_df.groupby([&#39;uid&#39;,&#39;trip_id&#39;])[&#39;v&#39;].transform(lambda x: x.mean())</span>
    <span class="n">progress_bar</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="c1"># temp_df[&#39;wind_speed&#39;]=temp_df.groupby([&#39;uid&#39;,&#39;trip_id&#39;])[&#39;s&#39;].transform(lambda x: x.mean())</span>
    <span class="n">progress_bar</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">temp_df</span><span class="p">[</span><span class="s2">&quot;is_weekend&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">temp_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;uid&quot;</span><span class="p">,</span> <span class="s2">&quot;trip_id&quot;</span><span class="p">])[</span><span class="s2">&quot;is_weekend&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span>
        <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="p">)</span>
    <span class="n">progress_bar</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">temp_df</span><span class="p">[</span><span class="s2">&quot;hour_category&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">temp_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;uid&quot;</span><span class="p">,</span> <span class="s2">&quot;trip_id&quot;</span><span class="p">])[</span>
        <span class="s2">&quot;hour_category&quot;</span>
    <span class="p">]</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">progress_bar</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">temp_df</span> <span class="o">=</span> <span class="n">temp_df</span><span class="p">[</span>
        <span class="p">[</span>
            <span class="s2">&quot;datetime&quot;</span><span class="p">,</span>
            <span class="s2">&quot;uid&quot;</span><span class="p">,</span>
            <span class="s2">&quot;trip_id&quot;</span><span class="p">,</span>
            <span class="s2">&quot;speed_median&quot;</span><span class="p">,</span>
            <span class="s2">&quot;speed_pct_95&quot;</span><span class="p">,</span>
            <span class="s2">&quot;speed_std&quot;</span><span class="p">,</span>
            <span class="s2">&quot;acceleration_median&quot;</span><span class="p">,</span>
            <span class="s2">&quot;acceleration_pct_95&quot;</span><span class="p">,</span>
            <span class="s2">&quot;acceleration_std&quot;</span><span class="p">,</span>
            <span class="s2">&quot;jerk_median&quot;</span><span class="p">,</span>
            <span class="s2">&quot;jerk_pct_95&quot;</span><span class="p">,</span>
            <span class="s2">&quot;jerk_std&quot;</span><span class="p">,</span>
            <span class="s2">&quot;angular_dev_median&quot;</span><span class="p">,</span>
            <span class="s2">&quot;angular_dev_pct_95&quot;</span><span class="p">,</span>
            <span class="s2">&quot;angular_dev_std&quot;</span><span class="p">,</span>
            <span class="s2">&quot;straightness_index&quot;</span><span class="p">,</span>
            <span class="s2">&quot;distance_covered&quot;</span><span class="p">,</span>
            <span class="s2">&quot;start_end_at_bus_stop&quot;</span><span class="p">,</span>
            <span class="s2">&quot;start_end_at_train_stop&quot;</span><span class="p">,</span>
            <span class="s2">&quot;start_end_at_metro_stop&quot;</span><span class="p">,</span>
            <span class="s2">&quot;found_at_green_space&quot;</span><span class="p">,</span>
            <span class="s2">&quot;is_weekend&quot;</span><span class="p">,</span>
            <span class="s2">&quot;hour_category&quot;</span><span class="p">,</span>
            <span class="s2">&quot;transport_mode&quot;</span><span class="p">,</span>
        <span class="p">]</span>
    <span class="p">]</span>
    <span class="n">progress_bar</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">temp_df</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="meowmotion.data_formatter.processData" class="doc doc-heading">
            <code class=" language-python"><span class="n">processData</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">shape_files</span><span class="p">)</span></code>

<a href="#meowmotion.data_formatter.processData" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Cleans and enriches raw trip-point data with motion-related features
(speed, acceleration, jerk, bearing, angular deviation, straightness
index) and contextual flags indicating proximity to public-transport
stops or green spaces.</p>
<p>The function operates <strong>per trip</strong> (<code>uid</code>–<code>trip_id</code>):
  1. Removes duplicate timestamps and drops trips with fewer than
     five distinct observations (<code>num_of_impressions</code> &lt; 5).
  2. Computes time deltas, inter-point distance (haversine), speed,
     speed z-scores, acceleration, and jerk, replacing extreme
     speed outliers (|z| ≥ 3) with the median speed.
  3. Derives temporal attributes—calendar month, hour of day,
     weekend flag, and a four-level <code>hour_category</code>
     (0 Night, 1 Morning, 2 Afternoon, 3 Evening).
  4. For each trip, determines whether the first and/or last point
     lies within
     • a <strong>bus stop</strong> (shape_files[0])
     • a <strong>train station</strong> (shape_files[1])
     • a <strong>metro station</strong> (shape_files[2])
     and whether <strong>≥ 5 points</strong> fall inside a <strong>green space</strong>
     polygon (shape_files[3]).
  5. Calculates a straightness index (straight-line ÷ actual path
     length) and removes trips with an index &gt; 1 (spurious data).</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>df</code>
            </td>
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Point-level trip data containing at least
<code>["uid", "trip_id", "lat", "lng", "datetime"]</code>.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>shape_files</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span>[<span title="geopandas.GeoDataFrame">GeoDataFrame</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of four
GeoDataFrames <strong>in this order</strong>:
<code>[bus_stops_gdf, train_stops_gdf, metro_stops_gdf,
green_space_gdf]</code>.  Each must use CRS EPSG 4326.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>pd.DataFrame: The cleaned and feature-rich DataFrame, one row</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>per retained point, including new columns such as</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <ul>
<li><code>num_of_impressions</code> • <code>time_taken</code> • <code>distance_covered</code></li>
</ul>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <ul>
<li><code>speed</code> • <code>speed_z_score</code> • <code>new_speed</code></li>
</ul>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <ul>
<li><code>accelaration</code> • <code>jerk</code></li>
</ul>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <ul>
<li><code>bearing</code> • <code>angular_deviation</code></li>
</ul>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <ul>
<li><code>month</code> • <code>hour</code> • <code>is_weekend</code> • <code>hour_category</code></li>
</ul>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <ul>
<li><code>start_end_at_bus_stop</code> / <code>train_stop</code> / <code>metro_stop</code></li>
</ul>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <ul>
<li><code>found_at_green_space</code> • <code>straightness_index</code></li>
</ul>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>processed = processData(raw_trip_df, [
...     bus_stops_gdf, train_stops_gdf, metro_stops_gdf,
...     green_space_gdf
... ])
processed.head()</p>
</blockquote>
</blockquote>
</blockquote>
</details>

            <details class="quote">
              <summary>Source code in <code>meowmotion/data_formatter.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">processData</span><span class="p">(</span><span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">shape_files</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Cleans and enriches raw trip-point data with motion-related features</span>
<span class="sd">    (speed, acceleration, jerk, bearing, angular deviation, straightness</span>
<span class="sd">    index) and contextual flags indicating proximity to public-transport</span>
<span class="sd">    stops or green spaces.</span>

<span class="sd">    The function operates **per trip** (``uid``–``trip_id``):</span>
<span class="sd">      1. Removes duplicate timestamps and drops trips with fewer than</span>
<span class="sd">         five distinct observations (``num_of_impressions`` &lt; 5).</span>
<span class="sd">      2. Computes time deltas, inter-point distance (haversine), speed,</span>
<span class="sd">         speed z-scores, acceleration, and jerk, replacing extreme</span>
<span class="sd">         speed outliers (|z| ≥ 3) with the median speed.</span>
<span class="sd">      3. Derives temporal attributes—calendar month, hour of day,</span>
<span class="sd">         weekend flag, and a four-level ``hour_category``</span>
<span class="sd">         (0 Night, 1 Morning, 2 Afternoon, 3 Evening).</span>
<span class="sd">      4. For each trip, determines whether the first and/or last point</span>
<span class="sd">         lies within</span>
<span class="sd">         • a **bus stop** (shape_files[0])</span>
<span class="sd">         • a **train station** (shape_files[1])</span>
<span class="sd">         • a **metro station** (shape_files[2])</span>
<span class="sd">         and whether **≥ 5 points** fall inside a **green space**</span>
<span class="sd">         polygon (shape_files[3]).</span>
<span class="sd">      5. Calculates a straightness index (straight-line ÷ actual path</span>
<span class="sd">         length) and removes trips with an index &gt; 1 (spurious data).</span>

<span class="sd">    Args:</span>
<span class="sd">        df (pd.DataFrame): Point-level trip data containing at least</span>
<span class="sd">            ``[&quot;uid&quot;, &quot;trip_id&quot;, &quot;lat&quot;, &quot;lng&quot;, &quot;datetime&quot;]``.</span>
<span class="sd">        shape_files (List[gpd.GeoDataFrame]): A list of four</span>
<span class="sd">            GeoDataFrames **in this order**:</span>
<span class="sd">            ``[bus_stops_gdf, train_stops_gdf, metro_stops_gdf,</span>
<span class="sd">            green_space_gdf]``.  Each must use CRS EPSG 4326.</span>

<span class="sd">    Returns:</span>
<span class="sd">        pd.DataFrame: The cleaned and feature-rich DataFrame, one row</span>
<span class="sd">        per retained point, including new columns such as</span>

<span class="sd">        * ``num_of_impressions`` • ``time_taken`` • ``distance_covered``</span>
<span class="sd">        * ``speed`` • ``speed_z_score`` • ``new_speed``</span>
<span class="sd">        * ``accelaration`` • ``jerk``</span>
<span class="sd">        * ``bearing`` • ``angular_deviation``</span>
<span class="sd">        * ``month`` • ``hour`` • ``is_weekend`` • ``hour_category``</span>
<span class="sd">        * ``start_end_at_bus_stop`` / ``train_stop`` / ``metro_stop``</span>
<span class="sd">        * ``found_at_green_space`` • ``straightness_index``</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; processed = processData(raw_trip_df, [</span>
<span class="sd">        ...     bus_stops_gdf, train_stops_gdf, metro_stops_gdf,</span>
<span class="sd">        ...     green_space_gdf</span>
<span class="sd">        ... ])</span>
<span class="sd">        &gt;&gt;&gt; processed.head()</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">temp_df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="c1"># In some trips, for very same timestamp, we observed multiple datapoints. To deal with that, dropping all the duplicate timestamps and keeping the first one</span>
    <span class="n">temp_df</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">temp_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;uid&quot;</span><span class="p">,</span> <span class="s2">&quot;trip_id&quot;</span><span class="p">],</span> <span class="n">group_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;datetime&quot;</span><span class="p">],</span> <span class="n">keep</span><span class="o">=</span><span class="s2">&quot;first&quot;</span><span class="p">))</span>
        <span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="c1"># Counting number of impressions in each trip</span>
    <span class="n">temp_df</span><span class="p">[</span><span class="s2">&quot;num_of_impressions&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">temp_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;uid&quot;</span><span class="p">,</span> <span class="s2">&quot;trip_id&quot;</span><span class="p">])[</span>
        <span class="p">[</span><span class="s2">&quot;datetime&quot;</span><span class="p">]</span>
    <span class="p">]</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>

    <span class="c1"># Filtering every trip with less than 5 impressions</span>
    <span class="n">temp_df</span> <span class="o">=</span> <span class="n">temp_df</span><span class="p">[</span><span class="n">temp_df</span><span class="o">.</span><span class="n">num_of_impressions</span> <span class="o">&gt;=</span> <span class="mi">5</span><span class="p">]</span>

    <span class="c1"># Cacluting the time taken (in seconds) to move from point to the next one in a trip</span>
    <span class="n">temp_df</span><span class="p">[</span><span class="s2">&quot;time_taken&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">temp_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;uid&quot;</span><span class="p">,</span> <span class="s2">&quot;trip_id&quot;</span><span class="p">])[</span><span class="s2">&quot;datetime&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span>
        <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span>
    <span class="p">)</span>

    <span class="c1"># Calculating Distance covered from previous point to current point</span>
    <span class="n">temp_df</span><span class="p">[</span><span class="s2">&quot;prev_lat&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">temp_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;uid&quot;</span><span class="p">,</span> <span class="s2">&quot;trip_id&quot;</span><span class="p">])[</span><span class="s2">&quot;lat&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span>
        <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">temp_df</span><span class="p">[</span><span class="s2">&quot;prev_long&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">temp_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;uid&quot;</span><span class="p">,</span> <span class="s2">&quot;trip_id&quot;</span><span class="p">])[</span><span class="s2">&quot;lng&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span>
        <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">temp_df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;prev_lat&quot;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">temp_df</span><span class="p">[</span><span class="s2">&quot;distance_covered&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">temp_df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
        <span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">haversine</span><span class="p">(</span>
            <span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;lat&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;lng&quot;</span><span class="p">]),</span>
            <span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;prev_lat&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;prev_long&quot;</span><span class="p">]),</span>
            <span class="n">unit</span><span class="o">=</span><span class="n">Unit</span><span class="o">.</span><span class="n">METERS</span><span class="p">,</span>
        <span class="p">),</span>
        <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># Calculating Speed with which the distance was covered</span>
    <span class="n">temp_df</span><span class="p">[</span><span class="s2">&quot;speed&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">temp_df</span><span class="o">.</span><span class="n">distance_covered</span> <span class="o">/</span> <span class="n">temp_df</span><span class="o">.</span><span class="n">time_taken</span>
    <span class="n">temp_df</span><span class="p">[</span><span class="s2">&quot;date&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">temp_df</span><span class="p">[</span><span class="s2">&quot;datetime&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">date</span>
    <span class="n">temp_df</span><span class="p">[</span><span class="s2">&quot;hour&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">temp_df</span><span class="p">[</span><span class="s2">&quot;datetime&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">hour</span>
    <span class="n">temp_df</span> <span class="o">=</span> <span class="n">temp_df</span><span class="o">.</span><span class="n">astype</span><span class="p">({</span><span class="s2">&quot;date&quot;</span><span class="p">:</span> <span class="s2">&quot;datetime64[ns]&quot;</span><span class="p">})</span>
    <span class="k">assert</span> <span class="n">temp_df</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isinf</span><span class="p">(</span><span class="n">temp_df</span><span class="p">[</span><span class="s2">&quot;speed&quot;</span><span class="p">])]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span>
    <span class="n">temp_df</span><span class="p">[</span><span class="s2">&quot;speed_z_score&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">temp_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;uid&quot;</span><span class="p">,</span> <span class="s2">&quot;trip_id&quot;</span><span class="p">])[[</span><span class="s2">&quot;speed&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span>
        <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">abs</span><span class="p">(</span><span class="n">stats</span><span class="o">.</span><span class="n">zscore</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
    <span class="p">)</span>

    <span class="c1"># Calculate Acceleration</span>
    <span class="n">temp_df</span><span class="p">[</span><span class="s2">&quot;new_speed&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">temp_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;uid&quot;</span><span class="p">,</span> <span class="s2">&quot;trip_id&quot;</span><span class="p">],</span> <span class="n">group_keys</span><span class="o">=</span><span class="kc">False</span><span class="p">)[</span>
        <span class="p">[</span><span class="s2">&quot;speed&quot;</span><span class="p">,</span> <span class="s2">&quot;speed_z_score&quot;</span><span class="p">]</span>
    <span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">removeOutlier</span><span class="p">)[</span><span class="s2">&quot;speed&quot;</span><span class="p">]</span>
    <span class="n">temp_df</span><span class="p">[</span><span class="s2">&quot;accelaration&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">temp_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;uid&quot;</span><span class="p">,</span> <span class="s2">&quot;trip_id&quot;</span><span class="p">])[</span>
        <span class="s2">&quot;new_speed&quot;</span>
    <span class="p">]</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">temp_df</span><span class="p">[</span><span class="s2">&quot;accelaration&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">temp_df</span><span class="p">[</span><span class="s2">&quot;new_speed&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">temp_df</span><span class="p">[</span><span class="s2">&quot;accelaration&quot;</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">/</span> <span class="n">temp_df</span><span class="p">[</span><span class="s2">&quot;time_taken&quot;</span><span class="p">]</span>
    <span class="n">temp_df</span><span class="p">[</span><span class="s2">&quot;jerk&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">temp_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;uid&quot;</span><span class="p">,</span> <span class="s2">&quot;trip_id&quot;</span><span class="p">])[</span><span class="s2">&quot;accelaration&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span>
        <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span>
    <span class="p">)</span>
    <span class="n">temp_df</span><span class="p">[</span><span class="s2">&quot;jerk&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">temp_df</span><span class="p">[</span><span class="s2">&quot;jerk&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">temp_df</span><span class="p">[</span><span class="s2">&quot;time_taken&quot;</span><span class="p">]</span>
    <span class="n">temp_df</span><span class="p">[</span><span class="s2">&quot;bearing&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">calculateBearing</span><span class="p">(</span>
        <span class="n">temp_df</span><span class="p">[</span><span class="s2">&quot;prev_lat&quot;</span><span class="p">],</span> <span class="n">temp_df</span><span class="p">[</span><span class="s2">&quot;prev_long&quot;</span><span class="p">],</span> <span class="n">temp_df</span><span class="p">[</span><span class="s2">&quot;lat&quot;</span><span class="p">],</span> <span class="n">temp_df</span><span class="p">[</span><span class="s2">&quot;lng&quot;</span><span class="p">]</span>
    <span class="p">)</span>
    <span class="n">temp_df</span><span class="p">[</span><span class="s2">&quot;angular_deviation&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">temp_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;uid&quot;</span><span class="p">,</span> <span class="s2">&quot;trip_id&quot;</span><span class="p">])[</span>
        <span class="s2">&quot;bearing&quot;</span>
    <span class="p">]</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">diff</span><span class="p">()))</span>
    <span class="n">temp_df</span><span class="p">[</span><span class="s2">&quot;month&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">temp_df</span><span class="p">[</span><span class="s2">&quot;datetime&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">month</span>
    <span class="n">temp_df</span><span class="p">[</span><span class="s2">&quot;hour&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">temp_df</span><span class="p">[</span><span class="s2">&quot;datetime&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">hour</span>
    <span class="n">temp_df</span><span class="p">[</span><span class="s2">&quot;is_weekend&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">temp_df</span><span class="p">[</span><span class="s2">&quot;datetime&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">dayofweek</span>
    <span class="n">temp_df</span><span class="p">[</span><span class="s2">&quot;is_weekend&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">temp_df</span><span class="o">.</span><span class="n">is_weekend</span><span class="o">.</span><span class="n">map</span><span class="p">({</span><span class="mi">5</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">temp_df</span> <span class="o">=</span> <span class="n">temp_df</span><span class="o">.</span><span class="n">astype</span><span class="p">({</span><span class="s2">&quot;is_weekend&quot;</span><span class="p">:</span> <span class="s2">&quot;int32&quot;</span><span class="p">})</span>
    <span class="n">conditions</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="n">temp_df</span><span class="o">.</span><span class="n">hour</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">temp_df</span><span class="o">.</span><span class="n">hour</span> <span class="o">&lt;</span> <span class="mi">6</span><span class="p">),</span>
        <span class="p">(</span><span class="n">temp_df</span><span class="o">.</span><span class="n">hour</span> <span class="o">&gt;=</span> <span class="mi">6</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">temp_df</span><span class="o">.</span><span class="n">hour</span> <span class="o">&lt;</span> <span class="mi">12</span><span class="p">),</span>
        <span class="p">(</span><span class="n">temp_df</span><span class="o">.</span><span class="n">hour</span> <span class="o">&gt;=</span> <span class="mi">12</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">temp_df</span><span class="o">.</span><span class="n">hour</span> <span class="o">&lt;</span> <span class="mi">18</span><span class="p">),</span>
        <span class="p">(</span><span class="n">temp_df</span><span class="o">.</span><span class="n">hour</span> <span class="o">&gt;=</span> <span class="mi">18</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">temp_df</span><span class="o">.</span><span class="n">hour</span> <span class="o">&lt;=</span> <span class="mi">23</span><span class="p">),</span>
    <span class="p">]</span>
    <span class="n">category</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>  <span class="c1"># Night, Morning, Afternoon, Evening</span>
    <span class="n">temp_df</span><span class="p">[</span><span class="s2">&quot;hour_category&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">conditions</span><span class="p">,</span> <span class="n">category</span><span class="p">)</span>

    <span class="n">group</span> <span class="o">=</span> <span class="n">temp_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;uid&quot;</span><span class="p">,</span> <span class="s2">&quot;trip_id&quot;</span><span class="p">])</span>
    <span class="n">temp_df</span><span class="p">[</span><span class="s2">&quot;trip_group&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">group</span><span class="o">.</span><span class="n">ngroup</span><span class="p">()</span>
    <span class="n">temp_df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;trip_group&quot;</span><span class="p">],</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1">###########################################################################################</span>

    <span class="n">new_df</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span>
        <span class="nb">range</span><span class="p">(</span><span class="n">temp_df</span><span class="p">[</span><span class="s2">&quot;trip_group&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()),</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Adding Stops and Green Space Features&quot;</span>
    <span class="p">):</span>
        <span class="n">tdf</span> <span class="o">=</span> <span class="n">temp_df</span><span class="p">[</span><span class="n">temp_df</span><span class="p">[</span><span class="s2">&quot;trip_group&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">i</span><span class="p">]</span>
        <span class="n">tdf</span> <span class="o">=</span> <span class="n">tdf</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">tdf</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;datetime&quot;</span><span class="p">],</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">tdf</span><span class="p">[</span><span class="s2">&quot;start_end_at_bus_stop&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">checkIfNearStop</span><span class="p">(</span><span class="n">tdf</span><span class="p">,</span> <span class="n">shape_files</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">tdf</span><span class="p">[</span><span class="s2">&quot;start_end_at_train_stop&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">checkIfNearStop</span><span class="p">(</span><span class="n">tdf</span><span class="p">,</span> <span class="n">shape_files</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">tdf</span><span class="p">[</span><span class="s2">&quot;start_end_at_metro_stop&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">checkIfNearStop</span><span class="p">(</span><span class="n">tdf</span><span class="p">,</span> <span class="n">shape_files</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">tdf</span><span class="p">[</span><span class="s2">&quot;found_at_green_space&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">checkIfAtGrrenSpace</span><span class="p">(</span><span class="n">tdf</span><span class="p">,</span> <span class="n">shape_files</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
        <span class="n">tdf</span><span class="p">[</span><span class="s2">&quot;straightness_index&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">calculateStraightnessIndex</span><span class="p">(</span><span class="n">tdf</span><span class="p">)</span>
        <span class="n">new_df</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tdf</span><span class="p">)</span>

    <span class="n">temp_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">new_df</span><span class="p">)</span>
    <span class="k">del</span> <span class="n">new_df</span>
    <span class="k">del</span> <span class="n">tdf</span>
    <span class="n">temp_df</span> <span class="o">=</span> <span class="n">temp_df</span><span class="p">[</span>
        <span class="n">temp_df</span><span class="p">[</span><span class="s2">&quot;straightness_index&quot;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">1</span>
    <span class="p">]</span>  <span class="c1"># Filtering out the trips with straightness index greater than 1</span>
    <span class="n">temp_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;trip_group&quot;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1">###########################################################################################</span>
    <span class="k">return</span> <span class="n">temp_df</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="meowmotion.data_formatter.processTripData" class="doc doc-heading">
            <code class=" language-python"><span class="n">processTripData</span><span class="p">(</span><span class="n">trip_point_df</span><span class="p">,</span> <span class="n">na_flow_df</span><span class="p">,</span> <span class="n">raw_df</span><span class="p">)</span></code>

<a href="#meowmotion.data_formatter.processTripData" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Processes trip-level data by expanding stored trip-point coordinates, merging
in origin-destination flows, and then attaching timestamps from a raw dataset.
The result is a single DataFrame containing trip points (latitude, longitude, and
timestamps) and corresponding origin/destination information.</p>


<details class="key-steps" open>
  <summary>Key Steps</summary>
  <ol>
<li>Expands list-based trip points in <code>trip_point_df</code> into individual rows
   for each (lat, lng) point.</li>
<li>Joins the expanded trip points to <code>na_flow_df</code> to retrieve origin,
   destination, and timing fields.</li>
<li>Filters trips to ensure total travel time does not exceed 24 hours.</li>
<li>Merges <code>raw_df</code> to add precise timestamps for each (lat, lng) point and
   ensures each point is within the trip's time window.</li>
</ol>
</details>

<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>trip_point_df</code>
            </td>
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Contains user IDs, trip IDs, and a column of list-based trip points.
Must have columns <code>["uid", "trip_id", "trip_points"]</code>.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>na_flow_df</code>
            </td>
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Non-aggregated OD flow data containing origin/destination coordinates
and timestamps (<code>org_leaving_time</code>, <code>dest_arival_time</code>, etc.).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>raw_df</code>
            </td>
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The raw dataset with columns <code>["uid", "datetime", "lat", "lng"]</code>, used
to match each trip point to a specific timestamp.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>pd.DataFrame: A cleaned and merged DataFrame with columns for each trip's</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>user ID, trip ID, origin/destination coordinates, and per-point latitude,</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>longitude, and timestamps.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<h3 id="meowmotion.data_formatter.processTripData--suppose-you-already-have-three-dataframes-trip_point_df-na_flow_df-raw_df">Suppose you already have three DataFrames: trip_point_df, na_flow_df, raw_df<a class="headerlink" href="#meowmotion.data_formatter.processTripData--suppose-you-already-have-three-dataframes-trip_point_df-na_flow_df-raw_df" title="Permanent link">&para;</a></h3>
<p>result_df = processTripData(trip_point_df, na_flow_df, raw_df)
print(result_df.head())
  uid  trip_id       lat       lng       datetime  org_lat  org_lng  ...
0   1       10  12.9716  77.59460  2023-01-01 ...   12.970  77.5940  ...
1   1       10  12.9720  77.59470  2023-01-01 ...   12.970  77.5940  ...
...</p>
</blockquote>
</blockquote>
</blockquote>
</details>

            <details class="quote">
              <summary>Source code in <code>meowmotion/data_formatter.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">processTripData</span><span class="p">(</span>
    <span class="n">trip_point_df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">na_flow_df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">raw_df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Processes trip-level data by expanding stored trip-point coordinates, merging</span>
<span class="sd">    in origin-destination flows, and then attaching timestamps from a raw dataset.</span>
<span class="sd">    The result is a single DataFrame containing trip points (latitude, longitude, and</span>
<span class="sd">    timestamps) and corresponding origin/destination information.</span>

<span class="sd">    Key Steps:</span>
<span class="sd">        1. Expands list-based trip points in `trip_point_df` into individual rows</span>
<span class="sd">           for each (lat, lng) point.</span>
<span class="sd">        2. Joins the expanded trip points to `na_flow_df` to retrieve origin,</span>
<span class="sd">           destination, and timing fields.</span>
<span class="sd">        3. Filters trips to ensure total travel time does not exceed 24 hours.</span>
<span class="sd">        4. Merges `raw_df` to add precise timestamps for each (lat, lng) point and</span>
<span class="sd">           ensures each point is within the trip&#39;s time window.</span>

<span class="sd">    Args:</span>
<span class="sd">        trip_point_df (pd.DataFrame):</span>
<span class="sd">            Contains user IDs, trip IDs, and a column of list-based trip points.</span>
<span class="sd">            Must have columns `[&quot;uid&quot;, &quot;trip_id&quot;, &quot;trip_points&quot;]`.</span>
<span class="sd">        na_flow_df (pd.DataFrame):</span>
<span class="sd">            Non-aggregated OD flow data containing origin/destination coordinates</span>
<span class="sd">            and timestamps (`org_leaving_time`, `dest_arival_time`, etc.).</span>
<span class="sd">        raw_df (pd.DataFrame):</span>
<span class="sd">            The raw dataset with columns `[&quot;uid&quot;, &quot;datetime&quot;, &quot;lat&quot;, &quot;lng&quot;]`, used</span>
<span class="sd">            to match each trip point to a specific timestamp.</span>

<span class="sd">    Returns:</span>
<span class="sd">        pd.DataFrame: A cleaned and merged DataFrame with columns for each trip&#39;s</span>
<span class="sd">        user ID, trip ID, origin/destination coordinates, and per-point latitude,</span>
<span class="sd">        longitude, and timestamps.</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # Suppose you already have three DataFrames: trip_point_df, na_flow_df, raw_df</span>
<span class="sd">        &gt;&gt;&gt; result_df = processTripData(trip_point_df, na_flow_df, raw_df)</span>
<span class="sd">        &gt;&gt;&gt; print(result_df.head())</span>
<span class="sd">          uid  trip_id       lat       lng       datetime  org_lat  org_lng  ...</span>
<span class="sd">        0   1       10  12.9716  77.59460  2023-01-01 ...   12.970  77.5940  ...</span>
<span class="sd">        1   1       10  12.9720  77.59470  2023-01-01 ...   12.970  77.5940  ...</span>
<span class="sd">        ...</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># trip_file_path = f&quot;{data_dir}/{city}/{year}/trip_points&quot;</span>
    <span class="c1"># trip_point_df = pd.read_csv(f&quot;{trip_file_path}/trip_points_500m_{year}.csv&quot;)</span>
    <span class="n">trip_point_df</span><span class="p">[</span><span class="s2">&quot;trip_points&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">trip_point_df</span><span class="p">[</span><span class="s2">&quot;trip_points&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">ast</span><span class="o">.</span><span class="n">literal_eval</span><span class="p">)</span>
    <span class="n">trip_point_df</span> <span class="o">=</span> <span class="n">trip_point_df</span><span class="o">.</span><span class="n">explode</span><span class="p">(</span><span class="s2">&quot;trip_points&quot;</span><span class="p">)</span>
    <span class="n">trip_point_df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;trip_points&quot;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">trip_point_df</span><span class="p">[[</span><span class="s2">&quot;lat&quot;</span><span class="p">,</span> <span class="s2">&quot;lng&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
        <span class="n">trip_point_df</span><span class="p">[</span><span class="s2">&quot;trip_points&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="n">index</span><span class="o">=</span><span class="n">trip_point_df</span><span class="o">.</span><span class="n">index</span>
    <span class="p">)</span>
    <span class="n">trip_point_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;trip_points&quot;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># na_flows_file_path = f&quot;{data_dir}/{city}/{year}/na_flows&quot;</span>
    <span class="c1"># tdf = pd.read_csv(na_flows_file_path + f&quot;/na_flows_500m_{year}.csv&quot;)</span>

    <span class="n">na_flow_df</span><span class="p">[</span><span class="s2">&quot;org_arival_time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">na_flow_df</span><span class="p">[</span><span class="s2">&quot;org_arival_time&quot;</span><span class="p">])</span>
    <span class="n">na_flow_df</span><span class="p">[</span><span class="s2">&quot;org_leaving_time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">na_flow_df</span><span class="p">[</span><span class="s2">&quot;org_leaving_time&quot;</span><span class="p">])</span>
    <span class="n">na_flow_df</span><span class="p">[</span><span class="s2">&quot;dest_arival_time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">na_flow_df</span><span class="p">[</span><span class="s2">&quot;dest_arival_time&quot;</span><span class="p">])</span>
    <span class="n">trip_point_df</span> <span class="o">=</span> <span class="n">trip_point_df</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
        <span class="n">na_flow_df</span><span class="p">[</span>
            <span class="p">[</span>
                <span class="s2">&quot;uid&quot;</span><span class="p">,</span>
                <span class="s2">&quot;trip_id&quot;</span><span class="p">,</span>
                <span class="s2">&quot;org_lat&quot;</span><span class="p">,</span>
                <span class="s2">&quot;org_lng&quot;</span><span class="p">,</span>
                <span class="s2">&quot;dest_lat&quot;</span><span class="p">,</span>
                <span class="s2">&quot;dest_lng&quot;</span><span class="p">,</span>
                <span class="s2">&quot;org_arival_time&quot;</span><span class="p">,</span>
                <span class="s2">&quot;org_leaving_time&quot;</span><span class="p">,</span>
                <span class="s2">&quot;dest_arival_time&quot;</span><span class="p">,</span>
            <span class="p">]</span>
        <span class="p">],</span>
        <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;uid&quot;</span><span class="p">,</span> <span class="s2">&quot;trip_id&quot;</span><span class="p">],</span>
        <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">trip_point_df</span> <span class="o">=</span> <span class="n">trip_point_df</span><span class="p">[</span>
        <span class="p">(</span>
            <span class="n">trip_point_df</span><span class="p">[</span><span class="s2">&quot;dest_arival_time&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">trip_point_df</span><span class="p">[</span><span class="s2">&quot;org_leaving_time&quot;</span><span class="p">]</span>
        <span class="p">)</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span>
        <span class="o">/</span> <span class="mi">3600</span>
        <span class="o">&lt;=</span> <span class="mi">24</span>
    <span class="p">]</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="si">}</span><span class="s2">: Merging raw data with trip data to get datetime&quot;</span><span class="p">)</span>
    <span class="n">trip_point_df</span> <span class="o">=</span> <span class="n">trip_point_df</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
        <span class="n">raw_df</span><span class="p">[[</span><span class="s2">&quot;uid&quot;</span><span class="p">,</span> <span class="s2">&quot;datetime&quot;</span><span class="p">,</span> <span class="s2">&quot;lat&quot;</span><span class="p">,</span> <span class="s2">&quot;lng&quot;</span><span class="p">]],</span>
        <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;uid&quot;</span><span class="p">,</span> <span class="s2">&quot;lat&quot;</span><span class="p">,</span> <span class="s2">&quot;lng&quot;</span><span class="p">],</span>
        <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="si">}</span><span class="s2">: Converting datetime to datetime object&quot;</span><span class="p">)</span>
    <span class="n">trip_point_df</span><span class="p">[</span><span class="s2">&quot;datetime&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">trip_point_df</span><span class="p">[</span><span class="s2">&quot;datetime&quot;</span><span class="p">])</span>
    <span class="n">trip_point_df</span> <span class="o">=</span> <span class="n">trip_point_df</span><span class="p">[</span>
        <span class="n">trip_point_df</span><span class="p">[</span><span class="s2">&quot;datetime&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">between</span><span class="p">(</span>
            <span class="n">trip_point_df</span><span class="p">[</span><span class="s2">&quot;org_leaving_time&quot;</span><span class="p">],</span> <span class="n">trip_point_df</span><span class="p">[</span><span class="s2">&quot;dest_arival_time&quot;</span><span class="p">]</span>
        <span class="p">)</span>
    <span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">trip_point_df</span><span class="p">[</span><span class="s2">&quot;datetime&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="si">}</span><span class="s2">: Validation Done&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">trip_point_df</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="meowmotion.data_formatter.readRawData" class="doc doc-heading">
            <code class=" language-python"><span class="n">readRawData</span><span class="p">(</span><span class="n">data_dir</span><span class="p">,</span> <span class="n">cpu_cores</span><span class="o">=</span><span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">cpu_count</span><span class="p">()</span> <span class="o">//</span> <span class="mi">2</span><span class="p">))</span></code>

<a href="#meowmotion.data_formatter.readRawData" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Reads and compiles raw JSON data files for a given year and city by parallel processing
multiple monthly files.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>cpu_cores</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The number of CPU cpu_cores to be used for parallel processing. By default, it uses half of the available cpu_cores.</p>
              </div>
            </td>
            <td>
                  <code><span title="max">max</span>(1, <span title="multiprocessing.cpu_count">cpu_count</span>() // 2)</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>data_dir</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The directory where the raw data files are stored.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>pd.DataFrame: A DataFrame containing compiled raw data from all monthly files.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>df = readRawData(2023, "path_to_root/city/year")
print(df.head())</p>
</blockquote>
</blockquote>
</blockquote>
</details>

            <details class="quote">
              <summary>Source code in <code>meowmotion/data_formatter.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">readRawData</span><span class="p">(</span>
    <span class="n">data_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">cpu_cores</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">cpu_count</span><span class="p">()</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Reads and compiles raw JSON data files for a given year and city by parallel processing</span>
<span class="sd">    multiple monthly files.</span>

<span class="sd">    Args:</span>
<span class="sd">        cpu_cores (int): The number of CPU cpu_cores to be used for parallel processing. By default, it uses half of the available cpu_cores.</span>
<span class="sd">        data_dir (str): The directory where the raw data files are stored.</span>

<span class="sd">    Returns:</span>
<span class="sd">        pd.DataFrame: A DataFrame containing compiled raw data from all monthly files.</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; df = readRawData(2023, &quot;path_to_root/city/year&quot;)</span>
<span class="sd">        &gt;&gt;&gt; print(df.head())</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">root</span> <span class="o">=</span> <span class="n">data_dir</span>
    <span class="n">month_files</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
    <span class="n">args</span> <span class="o">=</span> <span class="p">[(</span><span class="n">root</span><span class="p">,</span> <span class="n">mf</span><span class="p">)</span> <span class="k">for</span> <span class="n">mf</span> <span class="ow">in</span> <span class="n">month_files</span><span class="p">]</span>
    <span class="k">with</span> <span class="n">Pool</span><span class="p">(</span><span class="n">cpu_cores</span><span class="p">)</span> <span class="k">as</span> <span class="n">p</span><span class="p">:</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">starmap</span><span class="p">(</span><span class="n">readJsonFiles</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="meowmotion.data_formatter.removeOutlier" class="doc doc-heading">
            <code class=" language-python"><span class="n">removeOutlier</span><span class="p">(</span><span class="n">group</span><span class="p">)</span></code>

<a href="#meowmotion.data_formatter.removeOutlier" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Filters outliers in the <code>speed</code> column by replacing high z-score values (≥ 3) with
the median speed. This function is typically applied to each group within a larger
grouped DataFrame (e.g., a single trip trajectory).</p>


<details class="how-it-works" open>
  <summary>How It Works</summary>
  <ol>
<li>Calculates the median speed within the group.</li>
<li>Identifies rows where <code>speed_z_score</code> is ≥ 3.</li>
<li>Replaces those outlier <code>speed</code> values with the median speed.</li>
<li>Returns the modified group DataFrame.</li>
</ol>
</details>

<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>group</code>
            </td>
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Subset of a larger DataFrame, typically representing
one trip. Must contain at least:
- <code>speed</code>: The speed values to check.
- <code>speed_z_score</code>: The corresponding z-score values for speed.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>pd.DataFrame: The same DataFrame with outlier speeds replaced by the median.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>import pandas as pd
import numpy as np
data = {
...     'speed': [5.0, 120.0, 6.0],
...     'speed_z_score': [0.2, 3.5, 0.3]
... }
df = pd.DataFrame(data)
print(df)
     speed  speed_z_score
0     5.0            0.20
1   120.0            3.50
2     6.0            0.30</p>
<p>cleaned = removeOutlier(df)
print(cleaned)
     speed  speed_z_score
0     5.0            0.20
1     5.5            3.50  # replaced with median (5.5)
2     6.0            0.30</p>
</blockquote>
</blockquote>
</blockquote>
</details>

            <details class="quote">
              <summary>Source code in <code>meowmotion/data_formatter.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">removeOutlier</span><span class="p">(</span><span class="n">group</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Filters outliers in the `speed` column by replacing high z-score values (≥ 3) with</span>
<span class="sd">    the median speed. This function is typically applied to each group within a larger</span>
<span class="sd">    grouped DataFrame (e.g., a single trip trajectory).</span>

<span class="sd">    How It Works:</span>
<span class="sd">        1. Calculates the median speed within the group.</span>
<span class="sd">        2. Identifies rows where `speed_z_score` is ≥ 3.</span>
<span class="sd">        3. Replaces those outlier `speed` values with the median speed.</span>
<span class="sd">        4. Returns the modified group DataFrame.</span>

<span class="sd">    Args:</span>
<span class="sd">        group (pd.DataFrame): Subset of a larger DataFrame, typically representing</span>
<span class="sd">            one trip. Must contain at least:</span>
<span class="sd">            - `speed`: The speed values to check.</span>
<span class="sd">            - `speed_z_score`: The corresponding z-score values for speed.</span>

<span class="sd">    Returns:</span>
<span class="sd">        pd.DataFrame: The same DataFrame with outlier speeds replaced by the median.</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; import pandas as pd</span>
<span class="sd">        &gt;&gt;&gt; import numpy as np</span>
<span class="sd">        &gt;&gt;&gt; data = {</span>
<span class="sd">        ...     &#39;speed&#39;: [5.0, 120.0, 6.0],</span>
<span class="sd">        ...     &#39;speed_z_score&#39;: [0.2, 3.5, 0.3]</span>
<span class="sd">        ... }</span>
<span class="sd">        &gt;&gt;&gt; df = pd.DataFrame(data)</span>
<span class="sd">        &gt;&gt;&gt; print(df)</span>
<span class="sd">             speed  speed_z_score</span>
<span class="sd">        0     5.0            0.20</span>
<span class="sd">        1   120.0            3.50</span>
<span class="sd">        2     6.0            0.30</span>

<span class="sd">        &gt;&gt;&gt; cleaned = removeOutlier(df)</span>
<span class="sd">        &gt;&gt;&gt; print(cleaned)</span>
<span class="sd">             speed  speed_z_score</span>
<span class="sd">        0     5.0            0.20</span>
<span class="sd">        1     5.5            3.50  # replaced with median (5.5)</span>
<span class="sd">        2     6.0            0.30</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">group_speed</span> <span class="o">=</span> <span class="n">group</span><span class="p">[</span><span class="s2">&quot;speed&quot;</span><span class="p">]</span>
    <span class="n">group_z_score</span> <span class="o">=</span> <span class="n">group</span><span class="p">[</span><span class="s2">&quot;speed_z_score&quot;</span><span class="p">]</span>
    <span class="n">group_median_speed</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">group_speed</span><span class="p">)</span>
    <span class="n">group_speed</span><span class="p">[</span><span class="n">group_z_score</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">group_median_speed</span>
    <span class="n">group</span><span class="p">[</span><span class="s2">&quot;speed&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">group_speed</span>
    <span class="k">return</span> <span class="n">group</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.expand", "navigation.sections", "navigation.top", "content.code.annotate", "content.tabs.link", "search.highlight", "search.suggest"], "search": "../../assets/javascripts/workers/search.f8cc74c7.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.c8b220af.min.js"></script>
      
    
  </body>
</html>